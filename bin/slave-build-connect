#!/bin/sh

# shellcheck source=conf/default.conf
. "${0%/*}/../conf/default.conf"

if [ "${SSH_ORIGINAL_COMMAND%% *}" = "get-assignment" ] || \
  [ "${SSH_ORIGINAL_COMMAND%% *}" = "return-assignment" ]; then

  # small check to prevent some shell-injections
  if echo "${SSH_ORIGINAL_COMMAND}" | \
    grep -q '[^-a-zA-Z0-9.+_ ]'; then

    >&2 printf 'Invalid command: "%s".\n' "${SSH_ORIGINAL_COMMAND}"
    exit 42

  fi

  printf '%s %s' "$1" "${SSH_ORIGINAL_COMMAND}" >> \
    "${work_dir}/ssh-log"

  slave="$1" /bin/sh -c "${base_dir}/bin/${SSH_ORIGINAL_COMMAND}"

else

  >&2 printf 'Invalid command: "%s".\n' "${SSH_ORIGINAL_COMMAND}"
  exit 42

fi
